<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Text2PPT Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 2rem;
        }
        
        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 1.25rem;
            opacity: 0.95;
        }
        
        .badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }
        
        .card h2 {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 1rem;
        }
        
        .api-section {
            background: #f8f9ff;
            border: 2px solid #e0e7ff;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .api-section.active {
            background: #e7f5e7;
            border-color: #4caf50;
        }
        
        .api-section h3 {
            font-size: 1rem;
            margin-bottom: 0.75rem;
            color: #555;
        }
        
        .info-box {
            background: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
            border-radius: 4px;
        }
        
        .info-box strong {
            display: block;
            margin-bottom: 0.25rem;
        }
        
        .info-box ol {
            margin-left: 1.25rem;
            line-height: 1.6;
        }
        
        .info-box a {
            color: #1976d2;
            text-decoration: none;
            font-weight: 600;
        }
        
        .input-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        input[type="password"], input[type="text"] {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #e0e7ff;
            color: #667eea;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: #d0d9ff;
            transform: translateY(-1px);
        }
        
        .btn-secondary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-generate {
            padding: 1.25rem;
            font-size: 1.1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-generate:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-generate:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        textarea {
            width: 100%;
            height: 400px;
            padding: 1rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            font-size: 0.95rem;
            resize: vertical;
            line-height: 1.6;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .status {
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-weight: 500;
        }
        
        .status.info {
            background: #e3f2fd;
            color: #1976d2;
            border-left: 4px solid #2196f3;
        }
        
        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }
        
        .status.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }
        
        .preview {
            height: 400px;
            overflow-y: auto;
            padding: 0.5rem;
        }
        
        .preview:empty::before {
            content: '';
            display: block;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 150"><text x="100" y="70" font-size="48" text-anchor="middle" fill="%23ccc">📊</text><text x="100" y="100" font-size="14" text-anchor="middle" fill="%23999">Preview will appear here</text><text x="100" y="120" font-size="12" text-anchor="middle" fill="%23aaa">AI will design your slides</text></svg>') center/contain no-repeat;
        }
        
        .slide-preview {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .slide-preview.title-slide {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }
        
        .slide-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .slide-number {
            background: #667eea;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .slide-type {
            color: #666;
            font-size: 0.75rem;
            text-transform: uppercase;
        }
        
        .title-slide .slide-type {
            color: rgba(255,255,255,0.8);
        }
        
        .slide-title {
            font-size: 1.125rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .title-slide .slide-title {
            color: white;
            font-size: 1.25rem;
        }
        
        .slide-content ul {
            margin-left: 1.25rem;
            line-height: 1.6;
        }
        
        .example-btn {
            display: block;
            margin: 1rem auto 0;
            text-align: center;
            color: white;
            text-decoration: underline;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .example-btn:hover {
            opacity: 0.8;
        }
        
        .spinner {
            display: inline-block;
            width: 1em;
            height: 1em;
            border: 2px solid currentColor;
            border-right-color: transparent;
            border-radius: 50%;
            animation: spin 0.75s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .footer {
            text-align: center;
            color: white;
            font-size: 0.9rem;
            margin-top: 2rem;
            opacity: 0.9;
        }
        
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎨 AI Text2PPT Pro</h1>
            <p>Professional presentations powered by Claude AI</p>
            <span class="badge">Using html2pptx + PptxGenJS</span>
        </div>

        <div class="card" id="apiCard">
            <h2>🔑 API Configuration</h2>
            <div class="api-section" id="apiSection">
                <h3>Setup Your Anthropic API Key</h3>
                <div class="info-box">
                    <strong>To get your API key:</strong>
                    <ol>
                        <li>Go to <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a></li>
                        <li>Sign up or log in</li>
                        <li>Navigate to "API Keys"</li>
                        <li>Create and copy your key</li>
                    </ol>
                </div>
                <div class="input-group">
                    <input type="password" id="apiKey" placeholder="sk-ant-api03-...">
                    <button class="btn-primary" onclick="saveApiKey()">Save Key</button>
                </div>
            </div>
        </div>

        <div class="main-grid">
            <div class="card">
                <h2>📝 Your Content</h2>
                <textarea id="textInput" placeholder="Paste your text here...

Examples:
• Meeting notes
• Blog post or article
• Research findings
• Product description
• Business proposal

AI will automatically:
✓ Structure content into slides
✓ Choose appropriate colors
✓ Design professional layouts
✓ Create visual hierarchy"></textarea>
                
                <div id="status"></div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-top: 1rem;">
                    <button class="btn-secondary" onclick="generatePreview()" id="previewBtn" style="padding: 1rem; font-size: 1rem; font-weight: 600;">
                        👁️ Preview Slides
                    </button>
                    <button class="btn-generate" onclick="generatePresentation()" id="generateBtn" style="margin-top: 0; padding: 1rem; font-size: 1rem;">
                        ✨ Generate PowerPoint
                    </button>
                </div>
            </div>

            <div class="card">
                <h2>👁️ Slide Preview</h2>
                <div class="preview" id="preview"></div>
            </div>
        </div>

        <button class="example-btn" onclick="loadExample()">
            💡 Load example text
        </button>

        <div class="footer">
            <p>Professional presentations • Claude AI content structuring • html2pptx rendering</p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem;">All processing happens on your server • Your API key is stored locally</p>
        </div>
    </div>

    <script>
        // Global variable to store slide data
        let currentSlideData = null;

        // Load API key from localStorage
        window.addEventListener('load', () => {
            const savedKey = localStorage.getItem('anthropic_api_key');
            if (savedKey) {
                document.getElementById('apiKey').value = savedKey;
                document.getElementById('apiSection').classList.add('active');
            }
        });

        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                showStatus('Please enter your API key', 'error');
                return;
            }
            localStorage.setItem('anthropic_api_key', apiKey);
            document.getElementById('apiSection').classList.add('active');
            showStatus('✅ API key saved!', 'success');
        }

        // Generate preview of slides
        async function generatePreview() {
            const text = document.getElementById('textInput').value.trim();
            const apiKey = localStorage.getItem('anthropic_api_key');
            
            if (!apiKey) {
                showStatus('⚠️ Please enter your API key first!', 'error');
                document.getElementById('apiKey').focus();
                return;
            }
            
            if (!text) {
                showStatus('⚠️ Please enter some text!', 'error');
                return;
            }
            
            const previewBtn = document.getElementById('previewBtn');
            previewBtn.disabled = true;
            previewBtn.innerHTML = '<span class="spinner"></span> Generating preview...';
            
            showStatus('🤖 AI is analyzing your content...', 'info');
            document.getElementById('preview').innerHTML = '<div style="text-align: center; padding: 2rem;"><span class="spinner" style="width: 2rem; height: 2rem; border-width: 3px;"></span><p style="margin-top: 1rem; color: #666;">AI is designing your slides...</p></div>';
            
            try {
                const response = await fetch('/api/preview', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ text, apiKey })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Preview generation failed');
                }
                
                const slideData = await response.json();
                currentSlideData = slideData;
                
                // Display preview
                displayPreview(slideData);
                showStatus('✅ Preview ready! Click "Generate PowerPoint" to create your file.', 'success');
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('preview').innerHTML = '';
                if (error.message.includes('401') || error.message.includes('authentication')) {
                    showStatus('❌ Invalid API key. Please check and try again.', 'error');
                } else {
                    showStatus('❌ Error: ' + error.message, 'error');
                }
            } finally {
                previewBtn.disabled = false;
                previewBtn.innerHTML = '👁️ Preview Slides';
            }
        }

        function displayPreview(slideData) {
            const preview = document.getElementById('preview');
            const theme = slideData.designTheme;
            
            let html = `
                <div style="background: #f0f4ff; padding: 0.75rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid ${theme.colorPrimary};">
                    <strong style="color: ${theme.colorPrimary};">🎨 ${theme.name}</strong>
                    <p style="margin: 0.25rem 0 0 0; font-size: 0.85rem; color: #666;">${theme.description}</p>
                </div>
            `;
            
            slideData.slides.forEach((slide, index) => {
                const isTitle = slide.type === 'title';
                const bgColor = isTitle ? theme.colorPrimary : '#ffffff';
                const textColor = isTitle ? '#ffffff' : '#333';
                const borderColor = isTitle ? theme.colorPrimary : '#dee2e6';
                
                html += `
                    <div class="slide-preview ${isTitle ? 'title-slide' : ''}" style="background: ${bgColor}; border-color: ${borderColor};">
                        <div class="slide-header">
                            <span class="slide-number" style="background: ${theme.colorAccent};">Slide ${index + 1}</span>
                            <span class="slide-type" style="color: ${isTitle ? 'rgba(255,255,255,0.8)' : '#666'};">${slide.type === 'title' ? 'Title Slide' : slide.layout || 'Content'}</span>
                        </div>
                        <div class="slide-title" style="color: ${textColor};">${slide.title}</div>
                `;
                
                if (slide.subtitle) {
                    html += `<div style="color: ${textColor}; opacity: 0.9; font-size: 0.9rem; margin-top: 0.25rem;">${slide.subtitle}</div>`;
                }
                
                if (slide.content && slide.content.length > 0) {
                    if (slide.layout === 'two-column') {
                        const half = Math.ceil(slide.content.length / 2);
                        const col1 = slide.content.slice(0, half);
                        const col2 = slide.content.slice(half);
                        
                        html += `
                            <div class="slide-content" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 0.5rem;">
                                <ul style="margin: 0; padding-left: 1.25rem; font-size: 0.85rem; line-height: 1.4;">
                                    ${col1.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                                <ul style="margin: 0; padding-left: 1.25rem; font-size: 0.85rem; line-height: 1.4;">
                                    ${col2.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="slide-content">
                                <ul style="margin: 0.5rem 0 0 0; padding-left: 1.25rem; font-size: 0.85rem; line-height: 1.4;">
                                    ${slide.content.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                    }
                }
                
                html += `</div>`;
            });
            
            preview.innerHTML = html;
        }

        async function generatePresentation() {
            const text = document.getElementById('textInput').value.trim();
            const apiKey = localStorage.getItem('anthropic_api_key');
            
            if (!apiKey) {
                showStatus('⚠️ Please enter your API key first!', 'error');
                document.getElementById('apiKey').focus();
                return;
            }
            
            if (!text) {
                showStatus('⚠️ Please enter some text!', 'error');
                return;
            }
            
            // If no preview generated yet, generate one first
            if (!currentSlideData) {
                await generatePreview();
                if (!currentSlideData) return; // Preview failed
            }
            
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Creating PowerPoint...';
            showStatus('📊 Generating your professional PowerPoint...', 'info');
            
            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ text, apiKey, slideData: currentSlideData })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Generation failed');
                }
                
                // Download the file
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'AI-Presentation-Pro.pptx';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                showStatus('✅ Professional presentation downloaded successfully!', 'success');
            } catch (error) {
                console.error('Error:', error);
                if (error.message.includes('401') || error.message.includes('authentication')) {
                    showStatus('❌ Invalid API key. Please check and try again.', 'error');
                } else {
                    showStatus('❌ Error: ' + error.message, 'error');
                }
            } finally {
                btn.disabled = false;
                btn.innerHTML = '✨ Generate Professional PowerPoint';
            }
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        function loadExample() {
            document.getElementById('textInput').value = `The Future of Artificial Intelligence in Healthcare

Artificial intelligence is revolutionizing healthcare by improving diagnostics, personalizing treatment plans, and accelerating drug discovery. Machine learning algorithms can now detect diseases from medical images with accuracy rivaling human experts.

Key applications include early cancer detection through image analysis, predictive analytics for patient outcomes, robotic surgery assistance, and virtual health assistants. AI-powered tools are reducing diagnostic errors and helping doctors make better informed decisions.

The integration of AI with electronic health records enables personalized medicine by analyzing patient data to recommend optimal treatments. Natural language processing helps extract insights from medical literature and patient notes.

Challenges remain including data privacy concerns, the need for regulatory frameworks, potential algorithmic bias, and ensuring AI systems are explainable to healthcare providers. Despite these hurdles, AI promises to make healthcare more accessible and effective for everyone.`;
            // Auto-generate preview when example is loaded
            setTimeout(() => generatePreview(), 500);
        }
    </script>
</body>
</html>