<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>GENIS.AI Presentation and Document Generator</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/css/styles.css?v=<?php echo time(); ?>">
    <script async src="https://js.stripe.com/v3/buy-button.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="header-badges-row">
                    <h1 class="brand-name">GENIS.AI</h1>
                    <a href="https://www.producthunt.com/products/genis-ai?embed=true&utm_source=badge-featured&utm_medium=badge&utm_source=badge-genis&#0045;ai" target="_blank" class="product-hunt-badge">
                        <img src="https://api.producthunt.com/widgets/embed-image/v1/featured.svg?post_id=1030870&theme=light&t=1761434413944" alt="Product Hunt" style="height: 26px; width: auto; display: block;" />
                    </a>
                    <a href="https://github.com/skunpoj/pptx" target="_blank" class="github-shield-badge">
                        <img src="https://img.shields.io/github/stars/skunpoj/pptx?style=flat-square&color=24292e&labelColor=24292e&logo=github&logoColor=white&label=Star" alt="GitHub Star" style="height: 24px; width: auto; display: block;" />
                    </a>
                </div>
                <p class="brand-tagline">Transform Your Ideas into Presentations with AI</p>
            </div>
            <div class="header-right">
                <div style="display: flex; flex-direction: column; gap: 0.35rem; align-items: flex-end;">
                    <div class="header-features">
                        <span class="header-feature">ü§ñ AI-Powered</span>
                        <span class="header-feature">üìä Native Charts</span>
                        <span class="header-feature">üé® 8+ Themes</span>
                        <span class="header-feature">üîó Share Links</span>
                    </div>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <div id="userInfo" style="display: none; align-items: center; gap: 0.5rem;">
                            <img id="userAvatar" src="" alt="User" style="width: 24px; height: 24px; border-radius: 50%; border: 2px solid rgba(102, 126, 234, 0.3);">
                            <span id="userName" style="font-weight: 600; color: #667eea; font-size: 0.85rem;"></span>
                            <div id="subscriptionStatus" style="display: none; margin-left: 0.5rem;">
                                <span id="subscriptionBadge" style="font-size: 0.75rem; padding: 0.2rem 0.4rem; border-radius: 4px; font-weight: 600;"></span>
                            </div>
                        </div>
                        <a href="/login" class="login-btn" id="authBtn">
                            <span>üîê Login</span>
                        </a>
                        <div class="free-badge">
                            <span class="badge-icon">üéÅ</span>
                            <span class="badge-text">100% FREE</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="main-grid">
            <!-- Left Panel: Slide Content -->
            <div class="card content-panel">
                <h2>üìù Slide Content</h2>
                
                <!-- Main Content Editor -->
                <div class="content-editor-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <p style="margin: 0; color: #555; font-size: 0.95rem;">Enter or paste your content here, then generate preview</p>
                        <span id="contentCharCount" style="font-size: 0.85rem; color: #888; font-weight: 600;">0 characters / 0 words</span>
                    </div>
                    
                    <textarea id="textInput" class="content-textarea" placeholder="Type or paste your detailed presentation content here...

Example:
Company Overview
- Founded in 2020 with mission to innovate
- Serving 500+ clients globally  
- Revenue growth of 150% year-over-year

Our Products
- AI-powered analytics platform
- Real-time dashboard
- Custom reporting tools" oninput="window.updateCharCount('textInput', 'contentCharCount')"></textarea>
                </div>
                
                <!-- Quick Examples -->
                <div class="quick-examples" style="margin-top: 0.75rem;">
                    <p class="examples-label">üìö Quick Start Examples:</p>
                    <div class="examples-grid">
                        <button class="btn-secondary" onclick="window.loadExampleByCategory('tech')">üíª Tech</button>
                        <button class="btn-secondary" onclick="window.loadExampleByCategory('business')">üíº Business</button>
                        <button class="btn-secondary" onclick="window.loadExampleByCategory('education')">üìö Education</button>
                        <button class="btn-secondary" onclick="window.loadExampleByCategory('health')">üè• Healthcare</button>
                        <button class="btn-secondary" onclick="window.loadExampleByCategory('marketing')">üìà Marketing</button>
                        <button class="btn-secondary" onclick="window.loadExampleByCategory('environment')">üåç Environment</button>
                    </div>
                </div>
                
                <!-- Number of Slides Input -->
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.75rem; white-space: nowrap;">
                    <label class="option-label" style="margin: 0;">Number of slides:</label>
                    <input type="number" id="numSlides" value="6" min="3" max="20" class="number-input">
                    <span id="userSlideCount" style="font-size: 0.85rem; color: #667eea; font-weight: 600; margin-left: 0.5rem;"></span>
                </div>

                <!-- Stripe Buy Button and Generate Preview Button Row -->
                <div style="display: flex; gap: 0.75rem; align-items: center; margin-top: 0.75rem;">
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <div id="stripeButtonContainer">
                            <stripe-buy-button
                                buy-button-id="buy_btn_1SN5z9GfwbNFFG53MZKQw2qX"
                                publishable-key="pk_live_51OKYdlGfwbNFFG53ez9b6nQ0KuURqAwPV5TJNr4HSTq1MhLpoQoa38iceUvx4vpu5yFxgORYKOzV0Vfsn7GzixlU00ffZcxaVD"
                                style="flex: 0 0 auto;"
                            >
                            </stripe-buy-button>
                        </div>
                        <div id="promptPayContainer" style="display: none; margin-top: 0.5rem;">
                            <button id="promptPayBtn" onclick="createPromptPaySubscription()" 
                                    style="display: inline-block; padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 0.9rem; text-align: center; border: none; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                üáπüá≠ Pay with PromptPay
                            </button>
                            <div id="promptPayWarning" style="display: none; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; padding: 0.5rem; font-size: 0.8rem; color: #856404; margin-top: 0.5rem;">
                                ‚ö†Ô∏è <strong>Important:</strong> PromptPay is single-use. You'll need to add a credit card for automatic renewals.
                            </div>
                        </div>
                        <div id="emailMismatchWarning" style="display: none; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; padding: 0.5rem; font-size: 0.8rem; color: #856404;">
                            ‚ö†Ô∏è <strong>Subscription not found:</strong> No active subscription found for your email. Please subscribe to access premium features.
                        </div>
                    </div>
                    <button class="btn-primary btn-large" onclick="window.generatePreview()" id="previewBtn" style="flex: 1; min-width: 200px;">
                        üëÅÔ∏è Generate Preview
                    </button>
                </div>
            </div>

            <!-- Right Panel: Preview -->
            <div class="card preview-panel">
                <h2>üëÅÔ∏è Slide Preview</h2>
                
                <!-- Tab Navigation -->
                <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; border-bottom: 2px solid #ddd; align-items: center; flex-wrap: wrap;">
                    <button class="gallery-tab-btn active" id="slidesTabBtn" onclick="window.showSlidesPreview()">
                        üìÑ Slides
                    </button>
                    <button class="gallery-tab-btn" id="galleryTabBtn" onclick="window.showImageGallery()">
                        üñºÔ∏è Image Gallery
                    </button>
                    <div style="margin-left: auto; display: flex; align-items: center; gap: 0.75rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; cursor: pointer; font-size: 0.85rem; white-space: nowrap;">
                            <input type="checkbox" id="autoImageGenCheckbox" checked onchange="window.toggleAutoImageGen()">
                            <span style="color: #667eea; font-weight: 600;">ü§ñ Auto Generate Images</span>
                        </label>
                        <button class="btn-secondary" id="manualGenerateBtn" onclick="window.generateImagesForSlides()" style="padding: 0.5rem 1rem; font-size: 0.85rem; display: none; white-space: nowrap;">
                            üé® Generate All Images
                        </button>
                    </div>
                </div>
                
                <!-- Slides Preview Container -->
                <div class="preview" id="preview" style="overflow-y: auto !important; flex: 1 1 auto !important; min-height: 0 !important;"></div>
                
                <!-- Image Gallery Container -->
                <div id="imageGalleryContainer" style="display: none; overflow-y: auto !important; flex: 1 1 auto !important; min-height: 0 !important;"></div>
            </div>
        </div>

        <!-- Status Notification -->
        <div id="status"></div>

        <!-- Action Buttons Section -->
        <div id="actionButtonsContainer" style="max-width: none; width: 100%; padding: 0;">
            <!-- Generation Button Section (appears after preview) -->
            <div id="generationSection" style="display: none; margin-bottom: 1rem;">
                <div class="generation-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <!-- Left: Generate PowerPoint Button (stays here always) -->
                    <div class="card" id="generateButtonCard" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1.5rem; display: flex; flex-direction: column; justify-content: center;">
                        <button class="btn-generate btn-full" onclick="window.generatePresentation()" id="generateBtn" style="background: white; color: #667eea; font-size: 1.2rem; font-weight: 700; padding: 1rem; border: none; border-radius: 8px; cursor: pointer;">
                            ‚ú® Generate PowerPoint Presentation
                        </button>
                        <p style="text-align: center; font-size: 0.85rem; color: white; margin-top: 0.75rem; opacity: 0.95;">
                            Download PPTX, view slides online, auto-convert to PDF, or create shareable link
                        </p>
                    </div>
                    
                    <!-- Right: Results section (appears after generation) -->
                    <div id="generateResultsCard" style="display: none;">
                        <!-- Success message and share link will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Responsive CSS for generation grid -->
        <style>
            @media (max-width: 768px) {
                .generation-grid {
                    grid-template-columns: 1fr !important;
                }
            }
            
            /* Spinner animation for progress indicators */
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        </style>

        <!-- AI IDEA GENERATOR & THEME SELECTOR - Below modify slides section, above settings -->
        <div class="ai-theme-grid" id="aiThemeGrid">
            <!-- Login Overlay -->
            <div class="login-overlay" id="aiThemeOverlay">
                <div class="login-overlay-content">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üîê</div>
                    <h3>Sign In to Unlock Features</h3>
                    <p style="margin-bottom: 1rem;">Unlock AI Idea Generator and Color Themes with a free account</p>
                    <a href="/login" class="login-overlay-btn">Sign In Free</a>
                    <p style="margin-top: 1rem; font-size: 0.85rem; color: #888; margin-bottom: 0;">Get started in seconds ‚Ä¢ No credit card required</p>
                </div>
            </div>
            
            <!-- Left: AI Idea Generator -->
            <div class="card idea-generator-section protected-section" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); border: 3px solid #ff9a56;">
                <h3 style="margin: 0 0 0.5rem 0; color: #d35400; font-size: 1.3rem;">üí° AI Idea Generator</h3>
                <p class="section-description" style="color: #555; margin-bottom: 0.75rem;">Don't have content yet? Let AI expand your simple idea into detailed presentation content</p>
                
                <!-- Idea Input with Character Count -->
                <div style="margin-bottom: 0.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <span style="font-size: 0.9rem; font-weight: 600; color: #d35400;">Your Idea</span>
                        <span id="ideaCharCount" style="font-size: 0.85rem; color: #888; font-weight: 600;">0 characters / 0 words</span>
                    </div>
                    <textarea id="ideaInput" class="idea-input" placeholder="Describe your presentation idea..." oninput="window.updateCharCount('ideaInput', 'ideaCharCount')">Create a quarterly business review presentation for Q4 2024 showing sales performance, market trends, and strategic initiatives for the executive team.</textarea>
                </div>
                
                <!-- Expand Button -->
                <button class="btn-primary btn-large" onclick="window.generateFromPrompt()" id="promptBtn" style="width: 100%; margin-bottom: 0.75rem;">
                    üöÄ Expand Idea
                </button>
                <p class="helper-text" style="margin-bottom: 0.75rem; margin-top: 0;">This creates detailed text content that you can edit above before generating slides</p>
                
                <!-- File Upload Section (styled like checkboxes) -->
                <div class="checkbox-label checkbox-teal" style="display: block; cursor: default; margin-bottom: 0.5rem;">
                    <strong style="color: #0d9488; display: block; margin-bottom: 0.5rem;">üìé Upload Files (Documents & Images)</strong>
                    <span class="checkbox-desc" style="display: block; margin-bottom: 0.75rem;">Upload PowerPoint templates, documents for content, or images to insert directly into slides</span>
                    <input type="file" id="fileUpload" multiple accept=".txt,.pdf,.doc,.docx,.md,.pptx,.jpg,.jpeg,.png,.gif,.webp,.svg" class="file-input" style="width: 100%; padding: 0.5rem; border: 2px dashed #0d9488; border-radius: 6px; background: #f0fdfa; cursor: pointer; font-size: 0.85rem;">
                    
                    <!-- File List -->
                    <div id="fileList" class="file-list-container" style="margin-top: 0.75rem;"></div>
                </div>
                
                <!-- Options Checkboxes -->
                <div class="options-container">
                    <!-- Combined Image Options + Number of Images Row -->
                    <div class="checkbox-label checkbox-purple" style="display: grid; grid-template-columns: 1fr auto; gap: 1rem; align-items: start;">
                        <label style="display: flex; align-items: start; gap: 0.75rem; cursor: pointer; flex: 1;">
                            <input type="checkbox" id="generateImages" checked style="margin-top: 0.25rem; flex-shrink: 0;">
                            <span>
                                <strong>üñºÔ∏è AI Image Generation & Insertion</strong>
                                <span class="checkbox-desc">Generate AI image suggestions from content descriptions AND insert uploaded images directly into appropriate slides based on context</span>
                            </span>
                        </label>
                        <div style="display: flex; align-items: center; gap: 0.5rem; white-space: nowrap;">
                            <label style="font-weight: 600; color: #555; font-size: 0.9rem;">Images to generate:</label>
                            <input type="number" id="numImagesToGenerate" value="3" min="0" max="20" class="number-input" style="width: 70px;">
                        </div>
                    </div>
                    
                    <!-- Extract Colors Checkbox -->
                    <label class="checkbox-label checkbox-blue">
                        <input type="checkbox" id="extractColors" checked>
                        <span>
                            <strong>üé® Extract & auto-select color theme from uploaded files</strong>
                            <span class="checkbox-desc">File content will be incorporated and used together with your idea prompt. AI analyzes uploaded files to suggest and automatically select color themes based on file names/types (e.g., finance ‚Üí blue, healthcare ‚Üí teal)</span>
                        </span>
                    </label>
                    
                    <!-- Use as Template Checkbox -->
                    <label class="checkbox-label checkbox-orange">
                        <input type="checkbox" id="useAsTemplate" checked>
                        <span>
                            <strong>üìÑ Use uploaded PPTX as template/base</strong>
                            <span class="checkbox-desc">Uses uploaded PowerPoint file as template - preserves formatting, modifies content, or adds new slides</span>
                        </span>
                    </label>
                </div>
            </div>

            <!-- Right: Color Theme & Output Format -->
            <div class="card protected-section" id="themeSelector" style="background: #f0fff4; border: 2px solid #82C341;">
                <div class="theme-header">
                    <h3>üé® Choose Color Theme</h3>
                    <span id="suggestedBadge" class="suggested-badge" style="display: none;">AI Suggested</span>
                </div>
                <p class="theme-description">Select a color palette for your presentation (AI may suggest one based on your content)</p>
                <div id="themeGrid" class="theme-grid"></div>
                
                <!-- Output File Type Selection -->
                <label style="display: block; font-weight: 700; color: #2d8659; margin: 1.5rem 0 0.5rem 0;">üìÑ Output File Type:</label>
                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.5rem; border-radius: 6px; transition: background 0.2s;" class="file-type-option">
                            <input type="radio" name="outputType" value="pptx-direct" checked onchange="window.selectOutputType('pptx-direct')" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-weight: 600; color: #333; font-size: 0.85rem;">üìä PPTX Direct</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.5rem; border-radius: 6px; transition: background 0.2s;" class="file-type-option">
                            <input type="radio" name="outputType" value="pptx-skill" onchange="window.selectOutputType('pptx-skill')" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-weight: 600; color: #333; font-size: 0.85rem;">üìä PPTX Skill</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.5rem; border-radius: 6px; transition: background 0.2s;" class="file-type-option">
                            <input type="radio" name="outputType" value="docx" onchange="window.selectOutputType('docx')" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-weight: 600; color: #333; font-size: 0.85rem;">üìù Word</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.5rem; border-radius: 6px; transition: background 0.2s;" class="file-type-option">
                            <input type="radio" name="outputType" value="pdf" onchange="window.selectOutputType('pdf')" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-weight: 600; color: #333; font-size: 0.85rem;">üìÑ PDF</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.5rem; border-radius: 6px; transition: background 0.2s;" class="file-type-option">
                            <input type="radio" name="outputType" value="xlsx" onchange="window.selectOutputType('xlsx')" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-weight: 600; color: #333; font-size: 0.85rem;">üìà Excel</span>
                        </label>
                    </div>
                <p style="margin: 0.5rem 0 0 0; font-size: 0.8rem; color: #666;">Select the output format for your generated document</p>
            </div>
        </div>

        <!-- Settings Card -->
        <div class="card settings-card">
            <h2 onclick="window.toggleSettingsSection()" class="collapsible-header">
                <span>‚öôÔ∏è Advanced Configuration</span>
                <span id="settingsToggleIcon" class="toggle-icon">‚ñº</span>
            </h2>
            
            <div id="settingsSectionContainer" style="display: block;">
                <div class="settings-tabs">
                    <button class="settings-tab active" onclick="window.switchSettingsTab('api')" id="tab-api">
                        üîë API Keys
                    </button>
                    <button class="settings-tab" onclick="window.switchSettingsTab('prompts')" id="tab-prompts">
                        üìù AI Prompts
                    </button>
                </div>
                
                <!-- API Settings Content -->
                <div id="apiSettingsContent">
                    <h3 style="margin-top: 1rem;">üîë API Configuration</h3>
                
                    <!-- API Keys Grid - Left/Right Panel Layout -->
                    <div class="api-keys-grid">
                        <!-- Left Panel: Content Generation Provider -->
                        <div class="card api-keys-left-panel">
                            <h3 style="margin-top: 0; font-size: 1.1rem; color: #667eea;">üìù Content Generation</h3>
                            
                            <!-- Provider Selection for Content Generation -->
                            <div class="provider-selection">
                                <h3 style="font-size: 1rem;">AI Provider Selection</h3>
                                <p style="font-size: 0.85rem; color: #666; margin-bottom: 0.75rem;">Select which AI to use for writing presentation content and slide structure</p>
                                <div class="provider-buttons">
                                    <button class="provider-btn active" onclick="window.selectProvider('bedrock')" id="provider-bedrock">Bedrock</button>
                                    <button class="provider-btn" onclick="window.selectProvider('anthropic')" id="provider-anthropic">Anthropic</button>
                                    <button class="provider-btn" onclick="window.selectProvider('openai')" id="provider-openai">OpenAI</button>
                                    <button class="provider-btn" onclick="window.selectProvider('gemini')" id="provider-gemini">Gemini</button>
                                    <button class="provider-btn" onclick="window.selectProvider('openrouter')" id="provider-openrouter">OpenRouter</button>
                                </div>
                            </div>
                            
                            <!-- Content Generation API Key Forms -->
                            <div id="contentGenApiKeys" style="margin-top: 1rem;">
                                <!-- Anthropic Section -->
                                <div class="api-section provider-section" id="section-anthropic">
                                    <h3>Anthropic Claude API</h3>
                                    <div class="info-box">
                                        <strong>To get your API key:</strong>
                                        <ol>
                                            <li>Go to <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a></li>
                                            <li>Sign up or log in</li>
                                            <li>Navigate to "API Keys"</li>
                                            <li>Create and copy your key</li>
                                        </ol>
                                    </div>
                                    <form autocomplete="off" onsubmit="return false;">
                                        <div class="input-group">
                                            <input type="text" 
                                                   id="apiKey-anthropic" 
                                                   placeholder="sk-ant-api03-..."
                                                   autocomplete="off"
                                                   data-form-type="other"
                                                   data-lpignore="true"
                                                   name="not-a-password"
                                                   spellcheck="false"
                                                   style="font-family: monospace; letter-spacing: 0.5px;">
                                            <button class="btn-primary" onclick="window.saveApiKey('anthropic'); return false;" type="button">Save Key</button>
                                        </div>
                                    </form>
                                </div>

                                <!-- OpenAI Section -->
                                <div class="api-section provider-section" id="section-openai" style="display: none;">
                                    <h3>OpenAI API</h3>
                                    <div class="info-box">
                                        <strong>To get your API key:</strong>
                                        <ol>
                                            <li>Go to <a href="https://platform.openai.com/" target="_blank">platform.openai.com</a></li>
                                            <li>Sign up or log in</li>
                                            <li>Navigate to "API Keys"</li>
                                            <li>Create and copy your key</li>
                                        </ol>
                                    </div>
                                    <form autocomplete="off" onsubmit="return false;">
                                        <div class="input-group">
                                            <input type="text" 
                                                   id="apiKey-openai" 
                                                   placeholder="sk-..."
                                                   autocomplete="off"
                                                   data-form-type="other"
                                                   data-lpignore="true"
                                                   name="not-a-password"
                                                   spellcheck="false"
                                                   style="font-family: monospace; letter-spacing: 0.5px;">
                                            <button class="btn-primary" onclick="window.saveApiKey('openai'); return false;" type="button">Save Key</button>
                                        </div>
                                    </form>
                                </div>

                                <!-- Gemini Section -->
                                <div class="api-section provider-section" id="section-gemini" style="display: none;">
                                    <h3>Google Gemini API</h3>
                                    <div class="info-box">
                                        <strong>To get your API key:</strong>
                                        <ol>
                                            <li>Go to <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a></li>
                                            <li>Sign up or log in</li>
                                            <li>Click "Create API Key"</li>
                                            <li>Copy your key</li>
                                        </ol>
                                    </div>
                                    <form autocomplete="off" onsubmit="return false;">
                                        <div class="input-group">
                                            <input type="text" 
                                                   id="apiKey-gemini" 
                                                   placeholder="AIza..."
                                                   autocomplete="off"
                                                   data-form-type="other"
                                                   data-lpignore="true"
                                                   name="not-a-password"
                                                   spellcheck="false"
                                                   style="font-family: monospace; letter-spacing: 0.5px;">
                                            <button class="btn-primary" onclick="window.saveApiKey('gemini'); return false;" type="button">Save Key</button>
                                        </div>
                                    </form>
                                </div>

                                <!-- OpenRouter Section -->
                                <div class="api-section provider-section" id="section-openrouter" style="display: none;">
                                    <h3>OpenRouter API</h3>
                                    <div class="info-box">
                                        <strong>To get your API key:</strong>
                                        <ol>
                                            <li>Go to <a href="https://openrouter.ai/" target="_blank">openrouter.ai</a></li>
                                            <li>Sign up or log in</li>
                                            <li>Navigate to "Keys"</li>
                                            <li>Create and copy your key</li>
                                        </ol>
                                    </div>
                                    <form autocomplete="off" onsubmit="return false;">
                                        <div class="input-group">
                                            <input type="text" 
                                                   id="apiKey-openrouter" 
                                                   placeholder="sk-or-..."
                                                   autocomplete="off"
                                                   data-form-type="other"
                                                   data-lpignore="true"
                                                   name="not-a-password"
                                                   spellcheck="false"
                                                   style="font-family: monospace; letter-spacing: 0.5px;">
                                            <button class="btn-primary" onclick="window.saveApiKey('openrouter'); return false;" type="button">Save Key</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Panel: Image Generation Provider -->
                        <div class="card api-keys-right-panel">
                            <h3 style="margin-top: 0; font-size: 1.1rem; color: #ff9800;">üé® Image Generation</h3>
                            
                            <!-- Provider Selection for Image Generation -->
                            <div class="provider-selection">
                                <h3 style="font-size: 1rem;">AI Provider Selection</h3>
                                <p style="font-size: 0.85rem; color: #666; margin-bottom: 0.75rem;">Select which AI to use for creating actual images from descriptions (optional)</p>
                                <div class="provider-buttons">
                                    <button class="provider-btn-img active" onclick="window.selectImageProvider('huggingface')" id="img-provider-huggingface">
                                        ü§ó Hugging Face
                                        <span style="display: block; font-size: 0.7rem; opacity: 0.8;">Free API ‚Ä¢ Default</span>
                                    </button>
                                    <button class="provider-btn-img" onclick="window.selectImageProvider('dalle')" id="img-provider-dalle">DALL-E 3</button>
                                    <button class="provider-btn-img" onclick="window.selectImageProvider('stability')" id="img-provider-stability">Stability AI</button>
                                    <button class="provider-btn-img" onclick="window.selectImageProvider('gemini')" id="img-provider-gemini" disabled style="opacity: 0.5; cursor: not-allowed; position: relative;">
                                        Gemini Imagen
                                        <span style="display: block; font-size: 0.65rem; color: #e74c3c; font-weight: 700;">‚ö†Ô∏è Not Available</span>
                                    </button>
                                </div>
                                <p style="font-size: 0.75rem; color: #2ecc71; margin-top: 0.5rem; font-weight: 600;">üéÅ Hugging Face: FREE API access to Stable Diffusion & FLUX models!</p>
                                <p style="font-size: 0.75rem; color: #888; margin-top: 0.25rem; font-style: italic;">üí° Get free API key at <a href="https://huggingface.co/settings/tokens" target="_blank" style="color: #667eea;">huggingface.co/settings/tokens</a></p>
                            </div>
                            
                            <!-- Image Generation API Key Forms -->
                            <div id="imageGenApiKeys" style="margin-top: 1rem;">
                                <!-- Hugging Face Section (for image generation) - SHOWN BY DEFAULT & FIRST -->
                                <div class="api-section provider-section" id="section-huggingface">
                                    <h3>ü§ó Hugging Face API</h3>
                                    <div class="info-box" style="background: linear-gradient(135deg, #fff8e1 0%, #ffe0b2 100%); border-left: 4px solid #ff9800;">
                                        <strong style="color: #e65100;">üéÅ FREE Image Generation!</strong>
                                        <p style="margin-top: 0.5rem; color: #666;">Hugging Face offers <strong>FREE API access</strong> to powerful models like Stable Diffusion XL and FLUX.1</p>
                                        <strong style="margin-top: 1rem; display: block;">To get your FREE API key:</strong>
                                        <ol>
                                            <li>Go to <a href="https://huggingface.co/join" target="_blank">huggingface.co/join</a> (create account)</li>
                                            <li>Navigate to <a href="https://huggingface.co/settings/tokens" target="_blank">Settings ‚Üí Access Tokens</a></li>
                                            <li>Click "New token" or "Create new token"</li>
                                            <li>Give it a name (e.g., "GENIS.AI") and select "Read" access</li>
                                            <li>Copy your token (starts with <code>hf_...</code>)</li>
                                        </ol>
                                        <p style="margin-top: 0.5rem; color: #666;">üí° <strong>Note:</strong> Hugging Face is the default and recommended option for FREE unlimited image generation!</p>
                                    </div>
                                    <form autocomplete="off" onsubmit="return false;">
                                        <div class="input-group">
                                            <input type="text" 
                                                   id="apiKey-huggingface" 
                                                   placeholder="hf_..."
                                                   autocomplete="off"
                                                   data-form-type="other"
                                                   data-lpignore="true"
                                                   name="not-a-password"
                                                   spellcheck="false"
                                                   style="font-family: monospace; letter-spacing: 0.5px;">
                                            <button class="btn-primary" onclick="window.saveApiKey('huggingface'); return false;" type="button">Save Key</button>
                                        </div>
                                    </form>
                                </div>
                                
                                <!-- DALL-E Section (for image generation) - HIDDEN BY DEFAULT -->
                                <div class="api-section provider-section" id="section-dalle" style="display: none;">
                                    <h3>DALL-E 3 API (OpenAI)</h3>
                                    <div class="info-box">
                                        <strong>To get your API key:</strong>
                                        <ol>
                                            <li>Go to <a href="https://platform.openai.com/" target="_blank">platform.openai.com</a></li>
                                            <li>Sign up or log in</li>
                                            <li>Navigate to "API Keys"</li>
                                            <li>Create and copy your key</li>
                                        </ol>
                                        <p style="margin-top: 0.5rem; color: #666;">üí° <strong>Note:</strong> DALL-E 3 uses the same API key as OpenAI's text models. If you've already entered an OpenAI key above, it will be used automatically.</p>
                                    </div>
                                    <form autocomplete="off" onsubmit="return false;">
                                        <div class="input-group">
                                            <input type="text" 
                                                   id="apiKey-dalle" 
                                                   placeholder="sk-... (same as OpenAI)"
                                                   autocomplete="off"
                                                   data-form-type="other"
                                                   data-lpignore="true"
                                                   name="not-a-password"
                                                   spellcheck="false"
                                                   style="font-family: monospace; letter-spacing: 0.5px;">
                                            <button class="btn-primary" onclick="window.saveApiKey('dalle'); return false;" type="button">Save Key</button>
                                        </div>
                                    </form>
                                </div>
                                
                                <!-- Stability AI Section (for image generation) - HIDDEN BY DEFAULT -->
                                <div class="api-section provider-section" id="section-stability" style="display: none;">
                                    <h3>Stability AI API</h3>
                                    <div class="info-box">
                                        <strong>To get your API key:</strong>
                                        <ol>
                                            <li>Go to <a href="https://platform.stability.ai/" target="_blank">platform.stability.ai</a></li>
                                            <li>Sign up or log in</li>
                                            <li>Navigate to "API Keys"</li>
                                            <li>Create and copy your key</li>
                                        </ol>
                                        <p style="margin-top: 0.5rem; color: #666;">üí° <strong>Note:</strong> This key is only needed if you want to use Stability AI for image generation. It's separate from content generation.</p>
                                    </div>
                                    <form autocomplete="off" onsubmit="return false;">
                                        <div class="input-group">
                                            <input type="text" 
                                                   id="apiKey-stability" 
                                                   placeholder="sk-..."
                                                   autocomplete="off"
                                                   data-form-type="other"
                                                   data-lpignore="true"
                                                   name="not-a-password"
                                                   spellcheck="false"
                                                   style="font-family: monospace; letter-spacing: 0.5px;">
                                            <button class="btn-primary" onclick="window.saveApiKey('stability'); return false;" type="button">Save Key</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- AI Prompts Editor Tab -->
                <div id="promptsSettingsContent" style="display: none;">
                    <h3 style="margin-top: 1rem;">üìù AI Prompt Customization</h3>
                    <p class="prompts-description">Customize the AI prompts used for content generation, slide design, and file processing. All prompts are automatically backed up before changes.</p>
                    
                    <div id="promptEditorContainer">
                        <div class="prompts-cta">
                            <p style="text-align: center; color: #666;">Loading prompts...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer - Features & Guide Section -->
        <div class="footer">
            <div class="footer-content">
                <!-- Security Banner -->
                <div class="footer-security-banner">
                    <span class="security-icon">üîí</span>
                    <p>All processing on your server ‚Ä¢ Your API key stays local & secure</p>
    </div>

                <!-- Features Grid -->
                <div class="footer-section">
                    <h3 class="footer-section-title">‚ú® Powerful Features</h3>
                    
                    <!-- Vibrant Description -->
                    <div class="footer-description">
                        <p>
                            <strong>GENIS.AI</strong> is your ultimate AI-powered presentation creation platform that transforms ideas into stunning, professional presentations in seconds! 
                            Harness the power of cutting-edge AI models like Claude, GPT-5, Gemini, or our <strong>FREE Amazon Bedrock</strong> to generate beautiful slides with native charts, 
                            professional themes, live previews, and smart designs. Edit online, share instantly with unique links, auto-convert to PDF, and customize every detail‚Äîall while 
                            keeping your data secure on your own server. Whether you're crafting business pitches, educational content, or marketing presentations, GENIS.AI makes it effortless. 
                            <a href="https://aboutus.genis.ai" target="_blank" rel="noopener noreferrer" class="footer-link">Learn more about us ‚Üí</a>
                    </p>
                </div>
                
                    <div class="footer-features-grid">
                        <div class="footer-feature-card">
                            <div class="feature-icon">ü§ñ</div>
                            <strong>AI-Powered</strong>
                            <span>Claude, GPT-4, Gemini, or FREE Bedrock</span>
                    </div>
                        <div class="footer-feature-card">
                            <div class="feature-icon">üìä</div>
                            <strong>Native Charts</strong>
                            <span>Bar, Pie, Line, Area - fully editable</span>
                    </div>
                        <div class="footer-feature-card">
                            <div class="feature-icon">üé®</div>
                            <strong>8+ Themes</strong>
                            <span>Professional color schemes</span>
                    </div>
                        <div class="footer-feature-card">
                            <div class="feature-icon">üìÑ</div>
                            <strong>Auto PDF</strong>
                            <span>PPTX + PDF generated together</span>
                    </div>
                        <div class="footer-feature-card">
                            <div class="feature-icon">üîó</div>
                            <strong>Share Links</strong>
                            <span>One link, unlimited views</span>
                    </div>
                        <div class="footer-feature-card">
                            <div class="feature-icon">‚úèÔ∏è</div>
                            <strong>Edit Online</strong>
                            <span>Modify slides in browser</span>
                    </div>
                        <div class="footer-feature-card">
                            <div class="feature-icon">üëÅÔ∏è</div>
                            <strong>Live Preview</strong>
                            <span>See before you download</span>
                    </div>
                        <div class="footer-feature-card">
                            <div class="feature-icon">üéØ</div>
                            <strong>Smart Design</strong>
                            <span>Decorative shapes & graphics</span>
                        </div>
                    </div>
                </div>
                
                <!-- API Options -->
                <div class="footer-section">
                    <h3 class="footer-section-title">üîë Flexible API Options</h3>
                    <div class="footer-api-grid">
                        <div class="footer-api-card footer-api-featured">
                            <div class="api-badge featured">üíé Option 1</div>
                            <h4>Use Our FREE Amazon Bedrock!</h4>
                            <p>Don't have an API key? No problem! We provide <strong>FREE unlimited access</strong> to Amazon Bedrock (Claude 3.5 Sonnet) - no credit card, no sign up, no catch!</p>
                        </div>
                        <div class="footer-api-card">
                            <div class="api-badge">Option 2</div>
                            <h4>Bring Your Own Key (BYOK)</h4>
                            <p>Use your own Anthropic, OpenAI, Google Gemini, or OpenRouter API key. You control costs and usage.</p>
                    </div>
                    </div>
                </div>
                
                <!-- Quick Start Guide -->
                <div class="footer-section">
                    <h3 class="footer-section-title">üéØ Quick Start Guide</h3>
                    <div class="footer-steps-grid">
                        <div class="step-card">
                            <div class="step-number">1</div>
                            <p>Enter your API key (or skip to use FREE Bedrock)</p>
                </div>
                        <div class="step-card">
                            <div class="step-number">2</div>
                            <p>Type your content or use AI Idea Generator</p>
                </div>
                        <div class="step-card">
                            <div class="step-number">3</div>
                            <p>Click "Generate Preview" to see slides</p>
            </div>
                        <div class="step-card">
                            <div class="step-number">4</div>
                            <p>Modify slides if needed with AI assistance</p>
                        </div>
                        <div class="step-card">
                            <div class="step-number">5</div>
                            <p>Click "Generate PowerPoint" to download</p>
                        </div>
                        <div class="step-card">
                            <div class="step-number">6</div>
                            <p>View online, share links, or download PDF!</p>
                        </div>
        </div>
    </div>

                <p class="footer-credits">Powered by Claude AI, html2pptx + PptxGenJS</p>
                <p class="footer-billing">
                    <a href="https://billing.stripe.com/p/login/cNi3cv1GIcNT44zbzldnW00" target="_blank" rel="noopener noreferrer" class="footer-link">
                        üí≥ Manage Billing & Subscription
                    </a>
                </p>
            </div>
        </div>
    </div>


    <!-- Load JavaScript Modules -->
    <!-- Core modules first -->
    <script src="/js/themes.js"></script>
    <script src="/js/charts.js"></script>
    <script src="/js/ui.js"></script>
    <script src="/js/preview.js"></script>
    <script src="/js/imageGallery.js"></script>
    
    <!-- API modules BEFORE api.js (important for function exports) -->
    <!-- Using fresh file name to avoid caching issues -->
    <script src="/js/api/capabilities.js"></script>
    <script src="/js/api/slidePreview.js"></script>
    <script src="/js/api/generation.js"></script>
    <script src="/js/api/viewer.js"></script>
    <script src="/js/api/sharing.js"></script>
    <script src="/js/api/modification.js"></script>
    
    <!-- App and utilities -->
    <script src="/js/app.js"></script>
    <script src="/js/fileHandler.js"></script>
    <script src="/js/skills.js"></script>
    <script src="/js/promptEditor.js"></script>
    
    <!-- API.js LAST (it checks if functions are loaded) -->
    <script src="/js/api.js"></script>
    
    <!-- Integration Diagnostics Script -->
    <script>
        // Initialize character counts on page load
        window.addEventListener('load', function() {
            // Update character counts for textareas with initial content
            if (window.updateCharCount) {
                window.updateCharCount('textInput', 'contentCharCount');
                window.updateCharCount('ideaInput', 'ideaCharCount');
            }
        });
        
        // Run diagnostics on page load
        window.addEventListener('load', function() {
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            console.log('üîç GENIS.AI - INTEGRATION DIAGNOSTICS');
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            console.log('');
            
            let allPassed = true;
            
            // Check all required functions
            const requiredFunctions = {
                'window.showStatus': window.showStatus,
                'window.generatePreview': window.generatePreview,
                'window.generateFromPrompt': window.generateFromPrompt,
                'window.generatePresentation': window.generatePresentation,
                'window.displayPreview': window.displayPreview,
                'window.getApiKey': window.getApiKey,
                'window.modifySlides': window.modifySlides,
                'window.loadExampleByCategory': window.loadExampleByCategory,
                'window.selectProvider': window.selectProvider,
                'window.saveApiKey': window.saveApiKey,
                'window.displayThemeSelector': window.displayThemeSelector,
                'window.selectTheme': window.selectTheme
            };
            
            console.log('üìã FUNCTION EXPORTS CHECK:');
            console.log('‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');
            for (const [name, func] of Object.entries(requiredFunctions)) {
                const exists = typeof func === 'function';
                const status = exists ? '‚úÖ' : '‚ùå';
                console.log(`${status} ${name}: ${typeof func}`);
                if (!exists) allPassed = false;
            }
            console.log('');
            
            // Check colorThemes
            console.log('üé® THEMES CHECK:');
            console.log('‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');
            if (window.colorThemes && typeof window.colorThemes === 'object') {
                const themeCount = Object.keys(window.colorThemes).length;
                console.log(`‚úÖ window.colorThemes: ${themeCount} themes loaded`);
                console.log('   Themes:', Object.keys(window.colorThemes).join(', '));
            } else {
                console.log('‚ùå window.colorThemes: NOT LOADED');
                allPassed = false;
            }
            console.log('');
            
            // Check DOM elements
            console.log('üìÑ DOM ELEMENTS CHECK:');
            console.log('‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');
            const requiredElements = [
                'textInput', 'ideaInput', 'previewBtn', 'promptBtn',
                'preview', 'status', 'themeSelector', 'numSlides',
                'generateImages', 'extractColors', 'useAsTemplate', 'fileUpload'
            ];
            
            for (const id of requiredElements) {
                const element = document.getElementById(id);
                const status = element ? '‚úÖ' : '‚ùå';
                console.log(`${status} #${id}: ${element ? element.tagName : 'NOT FOUND'}`);
                if (!element) allPassed = false;
            }
            console.log('');
            
            // Check current provider
            console.log('‚öôÔ∏è  CONFIGURATION:');
            console.log('‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');
            console.log(`   Current Provider: ${window.currentProvider || 'NOT SET'}`);
            console.log(`   Current View: ${window.currentView || 'NOT SET'}`);
            console.log('');
            
            // Final summary
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            if (allPassed) {
                console.log('‚úÖ ALL CHECKS PASSED - Integration OK!');
                console.log('');
                console.log('üéØ Next steps:');
                console.log('   1. Set your API key in Advanced Configuration');
                console.log('   2. Try clicking "Generate Preview" button');
                console.log('   3. Try clicking "Expand Idea" button');
            } else {
                console.log('‚ùå SOME CHECKS FAILED - See errors above');
                console.log('');
                console.log('üîß Troubleshooting:');
                console.log('   1. Hard refresh: Ctrl+Shift+F5');
                console.log('   2. Clear cache and reload');
                console.log('   3. Check browser console for errors');
            }
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            console.log('');
            
            // Add visual indicator to page
            if (allPassed) {
                console.log('üí° TIP: All systems operational! You can now use the app.');
            } else {
                console.log('‚ö†Ô∏è  WARNING: Some systems not loaded properly!');
            }
        });
        
        // Test function for Generate Preview button
        window.testGeneratePreview = function() {
            console.log('üß™ Testing Generate Preview Button...');
            console.log('‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');
            
            if (typeof window.generatePreview !== 'function') {
                console.error('‚ùå window.generatePreview is NOT a function!');
                console.error('   Type:', typeof window.generatePreview);
                return;
            }
            console.log('‚úÖ window.generatePreview exists');
            
            if (typeof window.showStatus !== 'function') {
                console.error('‚ùå window.showStatus is NOT defined!');
                return;
            }
            console.log('‚úÖ window.showStatus exists');
            
            if (typeof window.getApiKey !== 'function') {
                console.error('‚ùå window.getApiKey is NOT defined!');
                return;
            }
            console.log('‚úÖ window.getApiKey exists');
            
            const textInput = document.getElementById('textInput');
            const previewBtn = document.getElementById('previewBtn');
            
            if (!textInput) {
                console.error('‚ùå #textInput element NOT found!');
                return;
            }
            console.log('‚úÖ #textInput element exists');
            
            if (!previewBtn) {
                console.error('‚ùå #previewBtn element NOT found!');
                return;
            }
            console.log('‚úÖ #previewBtn element exists');
            
            console.log('');
            console.log('‚úÖ All checks passed! Generate Preview should work!');
            console.log('   (Requires API key to actually generate)');
        };
        
        // Test function for Expand Idea button
        window.testExpandIdea = function() {
            console.log('üß™ Testing Expand Idea Button...');
            console.log('‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');
            
            if (typeof window.generateFromPrompt !== 'function') {
                console.error('‚ùå window.generateFromPrompt is NOT a function!');
                console.error('   Type:', typeof window.generateFromPrompt);
                return;
            }
            console.log('‚úÖ window.generateFromPrompt exists');
            
            if (typeof window.showStatus !== 'function') {
                console.error('‚ùå window.showStatus is NOT defined!');
                return;
            }
            console.log('‚úÖ window.showStatus exists');
            
            if (typeof window.getApiKey !== 'function') {
                console.error('‚ùå window.getApiKey is NOT defined!');
                return;
            }
            console.log('‚úÖ window.getApiKey exists');
            
            const ideaInput = document.getElementById('ideaInput');
            const promptBtn = document.getElementById('promptBtn');
            
            if (!ideaInput) {
                console.error('‚ùå #ideaInput element NOT found!');
                return;
            }
            console.log('‚úÖ #ideaInput element exists');
            
            if (!promptBtn) {
                console.error('‚ùå #promptBtn element NOT found!');
                return;
            }
            console.log('‚úÖ #promptBtn element exists');
            
            console.log('');
            console.log('‚úÖ All checks passed! Expand Idea should work!');
            console.log('   (Requires API key to actually generate)');
        };
        
        // Add keyboard shortcut for quick test
        document.addEventListener('keydown', function(e) {
            // Ctrl+Shift+D for diagnostics
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                e.preventDefault();
                console.clear();
                window.location.reload();
            }
            // Ctrl+Shift+T for test
            if (e.ctrlKey && e.shiftKey && e.key === 'T') {
                e.preventDefault();
                console.log('');
                testGeneratePreview();
                console.log('');
                testExpandIdea();
            }
        });
        
        // Check authentication state and update UI
        // Function to create PromptPay subscription
        async function createPromptPaySubscription() {
            try {
                const promptPayBtn = document.getElementById('promptPayBtn');
                const promptPayWarning = document.getElementById('promptPayWarning');
                
                // Show loading state
                promptPayBtn.textContent = 'üîÑ Creating PromptPay Session...';
                promptPayBtn.disabled = true;
                
                const response = await fetch('/api/promptpay/subscription', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        amount: 29900, // 299 THB
                        interval: 'month',
                        productName: 'GENIS.AI Premium Subscription',
                        description: 'AI-powered presentation generation service'
                    })
                });
                
                const data = await response.json();
                
                if (data.url) {
                    // Show warning before redirecting
                    promptPayWarning.style.display = 'block';
                    promptPayWarning.innerHTML = `
                        ‚ö†Ô∏è <strong>Important:</strong> PromptPay is single-use. You'll need to add a credit card for automatic renewals.
                        <br><br>Redirecting to PromptPay checkout...
                    `;
                    
                    // Redirect to Stripe checkout
                    setTimeout(() => {
                        window.location.href = data.url;
                    }, 2000);
                } else {
                    throw new Error(data.error || 'Failed to create PromptPay session');
                }
                
            } catch (error) {
                console.error('Error creating PromptPay subscription:', error);
                alert('Failed to create PromptPay subscription: ' + error.message);
                
                // Reset button
                const promptPayBtn = document.getElementById('promptPayBtn');
                promptPayBtn.textContent = 'üáπüá≠ Pay with PromptPay';
                promptPayBtn.disabled = false;
            }
        }

        // Function to check subscription status
        async function checkSubscriptionStatus() {
            try {
                const response = await fetch('/api/subscription');
                const subscriptionData = await response.json();
                
                const subscriptionStatus = document.getElementById('subscriptionStatus');
                const subscriptionBadge = document.getElementById('subscriptionBadge');
                const emailMismatchWarning = document.getElementById('emailMismatchWarning');
                const stripeBuyButton = document.querySelector('stripe-buy-button');
                const promptPayContainer = document.getElementById('promptPayContainer');
                
                if (subscriptionData.hasActiveSubscription) {
                    // User has active subscription - hide buy button
                    subscriptionBadge.textContent = '‚úÖ Active';
                    subscriptionBadge.style.background = '#d4edda';
                    subscriptionBadge.style.color = '#155724';
                    subscriptionBadge.style.border = '1px solid #c3e6cb';
                    subscriptionStatus.style.display = 'block';
                    
                    // Hide buy button and show subscription management link
                    const stripeButtonContainer = document.getElementById('stripeButtonContainer');
                    if (stripeButtonContainer) {
                        stripeButtonContainer.innerHTML = `
                            <a href="https://billing.stripe.com/p/login/cNi3cv1GIcNT44zbzldnW00" 
                               target="_blank" 
                               rel="noopener noreferrer"
                               style="display: inline-block; padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 0.9rem; text-align: center; transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.1);"
                               onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)'"
                               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)'">
                                üí≥ Manage Subscription
                            </a>
                        `;
                    }
                    
                    // Show email mismatch warning if emails don't match exactly
                    if (subscriptionData.emailMismatchWarning && !subscriptionData.exactEmailMatch) {
                        emailMismatchWarning.innerHTML = `
                            ‚ö†Ô∏è <strong>Subscription not found:</strong> Cannot find subscription for your email. 
                            You may have subscribed using a different email address.
                        `;
                        emailMismatchWarning.style.display = 'block';
                        
                        // Show buy button instead of manage subscription for email mismatch
                        const stripeButtonContainer = document.getElementById('stripeButtonContainer');
                        if (stripeButtonContainer) {
                            stripeButtonContainer.innerHTML = `
                                <stripe-buy-button
                                    buy-button-id="buy_btn_1SN5z9GfwbNFFG53MZKQw2qX"
                                    publishable-key="pk_live_51OKYdlGfwbNFFG53ez9b6nQ0KuURqAwPV5TJNr4HSTq1MhLpoQoa38iceUvx4vpu5yFxgORYKOzV0Vfsn7GzixlU00ffZcxaVD"
                                    style="flex: 0 0 auto;"
                                >
                                </stripe-buy-button>
                            `;
                        }
                    } else {
                        emailMismatchWarning.style.display = 'none';
                    }
                    
                } else if (subscriptionData.customerExists) {
                    // Customer exists but no active subscription - show buy button
                    subscriptionBadge.textContent = '‚ùå Inactive';
                    subscriptionBadge.style.background = '#f8d7da';
                    subscriptionBadge.style.color = '#721c24';
                    subscriptionBadge.style.border = '1px solid #f5c6cb';
                    subscriptionStatus.style.display = 'block';
                    
                    // Show buy button
                    const stripeButtonContainer = document.getElementById('stripeButtonContainer');
                    if (stripeButtonContainer) {
                        stripeButtonContainer.innerHTML = `
                            <stripe-buy-button
                                buy-button-id="buy_btn_1SN5z9GfwbNFFG53MZKQw2qX"
                                publishable-key="pk_live_51OKYdlGfwbNFFG53ez9b6nQ0KuURqAwPV5TJNr4HSTq1MhLpoQoa38iceUvx4vpu5yFxgORYKOzV0Vfsn7GzixlU00ffZcxaVD"
                                style="flex: 0 0 auto;"
                            >
                            </stripe-buy-button>
                        `;
                    }
                    
                    // Show email mismatch warning if emails don't match exactly
                    if (subscriptionData.emailMismatchWarning && !subscriptionData.exactEmailMatch) {
                        emailMismatchWarning.innerHTML = `
                            ‚ö†Ô∏è <strong>Email Mismatch:</strong> Your Stripe account uses a different email (${subscriptionData.customerEmail}). 
                            Please use the same email for both Auth0 and Stripe to avoid confusion.
                        `;
                        emailMismatchWarning.style.display = 'block';
                    } else {
                        emailMismatchWarning.style.display = 'none';
                    }
                    
                } else {
                    // No customer found - show buy button with warning
                    subscriptionBadge.textContent = '‚ö†Ô∏è No Account';
                    subscriptionBadge.style.background = '#fff3cd';
                    subscriptionBadge.style.color = '#856404';
                    subscriptionBadge.style.border = '1px solid #ffeaa7';
                    subscriptionStatus.style.display = 'block';
                    
                    // Show buy button
                    const stripeButtonContainer = document.getElementById('stripeButtonContainer');
                    if (stripeButtonContainer) {
                        stripeButtonContainer.innerHTML = `
                            <stripe-buy-button
                                buy-button-id="buy_btn_1SN5z9GfwbNFFG53MZKQw2qX"
                                publishable-key="pk_live_51OKYdlGfwbNFFG53ez9b6nQ0KuURqAwPV5TJNr4HSTq1MhLpoQoa38iceUvx4vpu5yFxgORYKOzV0Vfsn7GzixlU00ffZcxaVD"
                                style="flex: 0 0 auto;"
                            >
                            </stripe-buy-button>
                        `;
                    }
                    
                    // Show email mismatch warning
                    emailMismatchWarning.innerHTML = `
                        ‚ö†Ô∏è <strong>No Stripe Account Found:</strong> No subscription found for your email (${subscriptionData.email}). 
                        If you have a subscription under a different email, please contact support.
                    `;
                    emailMismatchWarning.style.display = 'block';
                }
                
            } catch (error) {
                console.error('Error checking subscription status:', error);
                // Hide subscription status on error
                const subscriptionStatus = document.getElementById('subscriptionStatus');
                subscriptionStatus.style.display = 'none';
                
                // Show buy button as fallback
                const stripeButtonContainer = document.getElementById('stripeButtonContainer');
                if (stripeButtonContainer) {
                    stripeButtonContainer.innerHTML = `
                        <stripe-buy-button
                            buy-button-id="buy_btn_1SN5z9GfwbNFFG53MZKQw2qX"
                            publishable-key="pk_live_51OKYdlGfwbNFFG53ez9b6nQ0KuURqAwPV5TJNr4HSTq1MhLpoQoa38iceUvx4vpu5yFxgORYKOzV0Vfsn7GzixlU00ffZcxaVD"
                            style="flex: 0 0 auto;"
                        >
                        </stripe-buy-button>
                    `;
                }
            }
        }

        window.addEventListener('load', async function() {
            try {
                const response = await fetch('/api/user');
                const data = await response.json();
                const authBtn = document.getElementById('authBtn');
                const userInfo = document.getElementById('userInfo');
                const userAvatar = document.getElementById('userAvatar');
                const userName = document.getElementById('userName');
                const aiThemeGrid = document.getElementById('aiThemeGrid');
                const themeSelector = document.getElementById('themeSelector');
                
                if (data.authenticated && data.user) {
                    // User is logged in
                    authBtn.href = '/logout';
                    authBtn.querySelector('span').textContent = 'üîì Logout';
                    
                    // Display user info
                    if (data.user.picture) {
                        userAvatar.src = data.user.picture;
                        userAvatar.style.display = 'block';
                    }
                    if (data.user.name) {
                        userName.textContent = data.user.name;
                    } else if (data.user.email) {
                        userName.textContent = data.user.email;
                    }
                    userInfo.style.display = 'flex';
                    
                    // Update slide count display
                    const userSlideCount = document.getElementById('userSlideCount');
                    if (userSlideCount && data.user.slideCount !== undefined) {
                        userSlideCount.textContent = `(Total: ${data.user.slideCount} slides)`;
                        userSlideCount.style.display = 'inline';
                    }
                    
                    // Check subscription status
                    checkSubscriptionStatus();
                    
                    // Enable protected sections (remove greyed-out state)
                    aiThemeGrid.classList.remove('protected-disabled');
                } else {
                    // User is not logged in
                    authBtn.href = '/login';
                    authBtn.querySelector('span').textContent = 'üîê Login';
                    
                    // Hide user info
                    userInfo.style.display = 'none';
                    
                    // Hide slide count for non-logged-in users
                    const userSlideCount = document.getElementById('userSlideCount');
                    if (userSlideCount) {
                        userSlideCount.style.display = 'none';
                    }
                    
                    // Hide subscription status for non-logged-in users
                    const subscriptionStatus = document.getElementById('subscriptionStatus');
                    const emailMismatchWarning = document.getElementById('emailMismatchWarning');
                    if (subscriptionStatus) {
                        subscriptionStatus.style.display = 'none';
                    }
                    if (emailMismatchWarning) {
                        emailMismatchWarning.style.display = 'none';
                    }
                    
                    // Disable protected sections (show greyed-out with overlay)
                    aiThemeGrid.classList.add('protected-disabled');
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                // On error, disable sections
                const aiThemeGrid = document.getElementById('aiThemeGrid');
                if (aiThemeGrid) {
                    aiThemeGrid.classList.add('protected-disabled');
                }
            }
        });
    </script>
    
    <!-- GitHub Buttons Script -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
</body>
</html>