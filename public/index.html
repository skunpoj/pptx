<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Text2PPT Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 2rem;
        }
        
        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 1.25rem;
            opacity: 0.95;
        }
        
        .badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }
        
        .card h2 {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 1rem;
        }
        
        .api-section {
            background: #f8f9ff;
            border: 2px solid #e0e7ff;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .api-section.active {
            background: #e7f5e7;
            border-color: #4caf50;
        }
        
        .api-section h3 {
            font-size: 1rem;
            margin-bottom: 0.75rem;
            color: #555;
        }
        
        .info-box {
            background: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
            border-radius: 4px;
        }
        
        .info-box strong {
            display: block;
            margin-bottom: 0.25rem;
        }
        
        .info-box ol {
            margin-left: 1.25rem;
            line-height: 1.6;
        }
        
        .info-box a {
            color: #1976d2;
            text-decoration: none;
            font-weight: 600;
        }
        
        .input-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        input[type="password"], input[type="text"] {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #e0e7ff;
            color: #667eea;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: #d0d9ff;
            transform: translateY(-1px);
        }
        
        .btn-secondary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-generate {
            padding: 1.25rem;
            font-size: 1.1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-generate:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-generate:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        textarea {
            width: 100%;
            height: 400px;
            padding: 1rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            font-size: 0.95rem;
            resize: vertical;
            line-height: 1.6;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .status {
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-weight: 500;
        }
        
        .status.info {
            background: #e3f2fd;
            color: #1976d2;
            border-left: 4px solid #2196f3;
        }
        
        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }
        
        .status.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }
        
        .preview {
            min-height: 400px;
            height: auto;
            max-height: 100%;
            overflow-y: auto;
            padding: 0.5rem;
        }
        
        .preview:empty::before {
            content: '';
            display: block;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 150"><text x="100" y="70" font-size="48" text-anchor="middle" fill="%23ccc">üìä</text><text x="100" y="100" font-size="14" text-anchor="middle" fill="%23999">Preview will appear here</text><text x="100" y="120" font-size="12" text-anchor="middle" fill="%23aaa">AI will design your slides</text></svg>') center/contain no-repeat;
        }
        
        .slide-preview {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .slide-preview.title-slide {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }
        
        .slide-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .slide-number {
            background: #667eea;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .slide-type {
            color: #666;
            font-size: 0.75rem;
            text-transform: uppercase;
        }
        
        .title-slide .slide-type {
            color: rgba(255,255,255,0.8);
        }
        
        .slide-title {
            font-size: 1.125rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .title-slide .slide-title {
            color: white;
            font-size: 1.25rem;
        }
        
        .slide-content ul {
            margin-left: 1.25rem;
            line-height: 1.6;
        }
        
        .example-btn {
            display: block;
            margin: 1rem auto 0;
            text-align: center;
            color: white;
            text-decoration: underline;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .example-btn:hover {
            opacity: 0.8;
        }
        
        .spinner {
            display: inline-block;
            width: 1em;
            height: 1em;
            border: 2px solid currentColor;
            border-right-color: transparent;
            border-radius: 50%;
            animation: spin 0.75s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .footer {
            text-align: center;
            color: white;
            font-size: 0.9rem;
            margin-top: 2rem;
            opacity: 0.9;
        }
        
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® AI Text2PPT Pro</h1>
            <p>Professional presentations powered by Claude AI</p>
            <span class="badge">Using html2pptx + PptxGenJS</span>
        </div>

        <div class="main-grid">
            <div class="card">
                <h2>üìù Your Content</h2>
                
                <textarea id="textInput" placeholder="Create a quarterly business review for Q4 2024 showing sales performance, market trends, and strategic initiatives for the executive team. Include data visualizations and action items.

"></textarea>
                
                <!-- File Upload and Options Section -->
                <div style="background: #f0fff4; border: 2px solid #86efac; border-radius: 12px; padding: 1rem; margin-top: 1rem; margin-bottom: 1rem;">
                    <h3 style="font-size: 1rem; margin-bottom: 0.75rem; color: #555;">üìé Attach Files (Optional)</h3>
                    <p style="font-size: 0.85rem; color: #666; margin-bottom: 0.75rem;">Upload files to use as base content or template. AI will use the text above to control how the files are converted.</p>
                    <input type="file" id="fileUpload" multiple accept=".txt,.pdf,.doc,.docx,.md,.pptx" style="font-size: 0.85rem; margin-bottom: 0.75rem;">
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                        <div>
                            <label style="display: block; font-size: 0.85rem; color: #555; margin-bottom: 0.25rem;">Number of slides:</label>
                            <input type="number" id="numSlides" value="6" min="3" max="20" style="width: 100%; padding: 0.5rem; border: 2px solid #ddd; border-radius: 8px; font-size: 0.9rem;">
                        </div>
                        <div style="display: flex; align-items: flex-end;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.5rem;">
                                <input type="checkbox" id="generateImages" style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 0.85rem; color: #555;">Generate AI images</span>
                            </label>
                        </div>
                    </div>
                    
                    <button class="btn-primary" onclick="generateFromPrompt()" id="promptBtn" style="width: 100%; padding: 0.75rem; margin-top: 0.75rem;">
                        ‚ú® Generate Content from Text/Files
                    </button>
                </div>
                
                <!-- Example Categories -->
                <div style="background: #fff8e1; border: 2px solid #ffc107; border-radius: 12px; padding: 1rem; margin-bottom: 1rem;">
                    <h3 style="font-size: 1rem; margin-bottom: 0.75rem; color: #555;">üìö Example Templates</h3>
                    <p style="font-size: 0.85rem; color: #666; margin-bottom: 0.75rem;">Choose a category to load example content into the text area above:</p>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem;">
                        <button class="btn-secondary" onclick="loadExampleByCategory('tech')" style="padding: 0.5rem; font-size: 0.85rem;">
                            üíª Technology
                        </button>
                        <button class="btn-secondary" onclick="loadExampleByCategory('business')" style="padding: 0.5rem; font-size: 0.85rem;">
                            üíº Business
                        </button>
                        <button class="btn-secondary" onclick="loadExampleByCategory('education')" style="padding: 0.5rem; font-size: 0.85rem;">
                            üìö Education
                        </button>
                        <button class="btn-secondary" onclick="loadExampleByCategory('health')" style="padding: 0.5rem; font-size: 0.85rem;">
                            üè• Healthcare
                        </button>
                        <button class="btn-secondary" onclick="loadExampleByCategory('marketing')" style="padding: 0.5rem; font-size: 0.85rem;">
                            üìà Marketing
                        </button>
                        <button class="btn-secondary" onclick="loadExampleByCategory('environment')" style="padding: 0.5rem; font-size: 0.85rem;">
                            üåç Environment
                        </button>
                    </div>
                </div>
                
                <div id="status"></div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-top: 1rem;">
                    <button class="btn-secondary" onclick="generatePreview()" id="previewBtn" style="padding: 1rem; font-size: 1rem; font-weight: 600;">
                        üëÅÔ∏è Preview Slides
                    </button>
                    <button class="btn-generate" onclick="generatePresentation()" id="generateBtn" style="margin-top: 0; padding: 1rem; font-size: 1rem;">
                        ‚ú® Generate PowerPoint
                    </button>
                </div>
            </div>

            <div class="card">
                <h2>üëÅÔ∏è Slide Preview</h2>
                <div class="preview" id="preview"></div>
            </div>
        </div>

        <div class="card" id="apiCard" style="margin-top: 1.5rem;">
            <h2 onclick="toggleApiSection()" style="cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
                <span>üîë API Configuration</span>
                <span id="apiToggleIcon" style="font-size: 1.2rem;">‚ñº</span>
            </h2>
            
            <div id="apiSectionContainer" style="margin-top: 1rem;">
                <!-- Provider Selection -->
                <div style="background: #f0f4ff; border: 2px solid #e0e7ff; border-radius: 12px; padding: 1rem; margin-bottom: 1rem;">
                    <h3 style="font-size: 1rem; margin-bottom: 0.75rem; color: #555;">Select AI Provider</h3>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem;">
                        <button class="provider-btn active" onclick="selectProvider('anthropic')" id="provider-anthropic" style="padding: 0.75rem; border: 2px solid #667eea; background: #e0e7ff; border-radius: 8px; cursor: pointer; font-weight: 600; color: #667eea;">
                            Anthropic
                        </button>
                        <button class="provider-btn" onclick="selectProvider('openai')" id="provider-openai" style="padding: 0.75rem; border: 2px solid #ddd; background: white; border-radius: 8px; cursor: pointer; font-weight: 600; color: #666;">
                            OpenAI
                        </button>
                        <button class="provider-btn" onclick="selectProvider('gemini')" id="provider-gemini" style="padding: 0.75rem; border: 2px solid #ddd; background: white; border-radius: 8px; cursor: pointer; font-weight: 600; color: #666;">
                            Gemini
                        </button>
                        <button class="provider-btn" onclick="selectProvider('openrouter')" id="provider-openrouter" style="padding: 0.75rem; border: 2px solid #ddd; background: white; border-radius: 8px; cursor: pointer; font-weight: 600; color: #666;">
                            OpenRouter
                        </button>
                    </div>
                </div>

                <!-- Anthropic Section -->
                <div class="api-section provider-section" id="section-anthropic">
                    <h3>Anthropic Claude API</h3>
                    <div class="info-box">
                        <strong>To get your API key:</strong>
                        <ol>
                            <li>Go to <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a></li>
                            <li>Sign up or log in</li>
                            <li>Navigate to "API Keys"</li>
                            <li>Create and copy your key</li>
                        </ol>
                    </div>
                    <div class="input-group">
                        <input type="password" id="apiKey-anthropic" placeholder="sk-ant-api03-...">
                        <button class="btn-primary" onclick="saveApiKey('anthropic')">Save Key</button>
                    </div>
                </div>

                <!-- OpenAI Section -->
                <div class="api-section provider-section" id="section-openai" style="display: none;">
                    <h3>OpenAI API</h3>
                    <div class="info-box">
                        <strong>To get your API key:</strong>
                        <ol>
                            <li>Go to <a href="https://platform.openai.com/" target="_blank">platform.openai.com</a></li>
                            <li>Sign up or log in</li>
                            <li>Navigate to "API Keys"</li>
                            <li>Create and copy your key</li>
                        </ol>
                    </div>
                    <div class="input-group">
                        <input type="password" id="apiKey-openai" placeholder="sk-...">
                        <button class="btn-primary" onclick="saveApiKey('openai')">Save Key</button>
                    </div>
                </div>

                <!-- Gemini Section -->
                <div class="api-section provider-section" id="section-gemini" style="display: none;">
                    <h3>Google Gemini API</h3>
                    <div class="info-box">
                        <strong>To get your API key:</strong>
                        <ol>
                            <li>Go to <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a></li>
                            <li>Sign up or log in</li>
                            <li>Click "Create API Key"</li>
                            <li>Copy your key</li>
                        </ol>
                    </div>
                    <div class="input-group">
                        <input type="password" id="apiKey-gemini" placeholder="AIza...">
                        <button class="btn-primary" onclick="saveApiKey('gemini')">Save Key</button>
                    </div>
                </div>

                <!-- OpenRouter Section -->
                <div class="api-section provider-section" id="section-openrouter" style="display: none;">
                    <h3>OpenRouter API</h3>
                    <div class="info-box">
                        <strong>To get your API key:</strong>
                        <ol>
                            <li>Go to <a href="https://openrouter.ai/" target="_blank">openrouter.ai</a></li>
                            <li>Sign up or log in</li>
                            <li>Navigate to "Keys"</li>
                            <li>Create and copy your key</li>
                        </ol>
                    </div>
                    <div class="input-group">
                        <input type="password" id="apiKey-openrouter" placeholder="sk-or-...">
                        <button class="btn-primary" onclick="saveApiKey('openrouter')">Save Key</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Professional presentations ‚Ä¢ Claude AI content structuring ‚Ä¢ html2pptx rendering</p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem;">All processing happens on your server ‚Ä¢ Your API key is stored locally</p>
        </div>
    </div>

    <script>
        // Global variable to store slide data
        let currentSlideData = null;
        let currentProvider = 'anthropic';

        // Load API keys and provider from localStorage
        window.addEventListener('load', () => {
            // Load saved provider
            const savedProvider = localStorage.getItem('ai_provider') || 'anthropic';
            currentProvider = savedProvider;
            selectProvider(savedProvider);
            
            // Load all saved keys
            ['anthropic', 'openai', 'gemini', 'openrouter'].forEach(provider => {
                const savedKey = localStorage.getItem(`${provider}_api_key`);
                if (savedKey) {
                    document.getElementById(`apiKey-${provider}`).value = savedKey;
                }
            });
            
            // Check if collapsed state was saved
            const isCollapsed = localStorage.getItem('api_section_collapsed') === 'true';
            if (isCollapsed) {
                toggleApiSection();
            }
        });

        function toggleApiSection() {
            const container = document.getElementById('apiSectionContainer');
            const icon = document.getElementById('apiToggleIcon');
            
            if (container.style.display === 'none') {
                container.style.display = 'block';
                icon.textContent = '‚ñº';
                localStorage.setItem('api_section_collapsed', 'false');
            } else {
                container.style.display = 'none';
                icon.textContent = '‚ñ∂';
                localStorage.setItem('api_section_collapsed', 'true');
            }
        }

        function selectProvider(provider) {
            currentProvider = provider;
            localStorage.setItem('ai_provider', provider);
            
            // Update button styles
            document.querySelectorAll('.provider-btn').forEach(btn => {
                btn.style.border = '2px solid #ddd';
                btn.style.background = 'white';
                btn.style.color = '#666';
            });
            
            const activeBtn = document.getElementById(`provider-${provider}`);
            activeBtn.style.border = '2px solid #667eea';
            activeBtn.style.background = '#e0e7ff';
            activeBtn.style.color = '#667eea';
            
            // Show/hide sections
            document.querySelectorAll('.provider-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(`section-${provider}`).style.display = 'block';
        }

        function saveApiKey(provider) {
            const apiKey = document.getElementById(`apiKey-${provider}`).value.trim();
            if (!apiKey) {
                showStatus('Please enter your API key', 'error');
                return;
            }
            localStorage.setItem(`${provider}_api_key`, apiKey);
            showStatus(`‚úÖ ${provider.charAt(0).toUpperCase() + provider.slice(1)} API key saved!`, 'success');
        }

        function getApiKey() {
            return localStorage.getItem(`${currentProvider}_api_key`);
        }

        // Generate preview of slides
        async function generatePreview() {
            const text = document.getElementById('textInput').value.trim();
            const apiKey = getApiKey();
            
            if (!apiKey) {
                showStatus('‚ö†Ô∏è Please enter your API key first!', 'error');
                return;
            }
            
            if (!text) {
                showStatus('‚ö†Ô∏è Please enter some text!', 'error');
                return;
            }
            
            const previewBtn = document.getElementById('previewBtn');
            previewBtn.disabled = true;
            previewBtn.innerHTML = '<span class="spinner"></span> Generating preview...';
            
            showStatus('ü§ñ AI is analyzing your content...', 'info');
            document.getElementById('preview').innerHTML = '<div style="text-align: center; padding: 2rem;"><span class="spinner" style="width: 2rem; height: 2rem; border-width: 3px;"></span><p style="margin-top: 1rem; color: #666;">AI is designing your slides...</p></div>';
            
            try {
                const response = await fetch('/api/preview', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ text, apiKey, provider: currentProvider })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Preview generation failed');
                }
                
                const slideData = await response.json();
                currentSlideData = slideData;
                
                // Display preview
                displayPreview(slideData);
                showStatus('‚úÖ Preview ready! Click "Generate PowerPoint" to create your file.', 'success');
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('preview').innerHTML = '';
                if (error.message.includes('401') || error.message.includes('authentication')) {
                    showStatus('‚ùå Invalid API key. Please check and try again.', 'error');
                } else {
                    showStatus('‚ùå Error: ' + error.message, 'error');
                }
            } finally {
                previewBtn.disabled = false;
                previewBtn.innerHTML = 'üëÅÔ∏è Preview Slides';
            }
        }

        function displayPreview(slideData) {
            const preview = document.getElementById('preview');
            const theme = slideData.designTheme;
            
            let html = `
                <div style="background: #f0f4ff; padding: 0.75rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid ${theme.colorPrimary};">
                    <strong style="color: ${theme.colorPrimary};">üé® ${theme.name}</strong>
                    <p style="margin: 0.25rem 0 0 0; font-size: 0.85rem; color: #666;">${theme.description}</p>
                </div>
            `;
            
            slideData.slides.forEach((slide, index) => {
                const isTitle = slide.type === 'title';
                const bgColor = isTitle ? theme.colorPrimary : '#ffffff';
                const textColor = isTitle ? '#ffffff' : '#333';
                const borderColor = isTitle ? theme.colorPrimary : '#dee2e6';
                
                html += `
                    <div class="slide-preview ${isTitle ? 'title-slide' : ''}" style="background: ${bgColor}; border-color: ${borderColor};">
                        <div class="slide-header">
                            <span class="slide-number" style="background: ${theme.colorAccent};">Slide ${index + 1}</span>
                            <span class="slide-type" style="color: ${isTitle ? 'rgba(255,255,255,0.8)' : '#666'};">${slide.type === 'title' ? 'Title Slide' : slide.layout || 'Content'}</span>
                        </div>
                        <div class="slide-title" style="color: ${textColor};">${slide.title}</div>
                `;
                
                if (slide.subtitle) {
                    html += `<div style="color: ${textColor}; opacity: 0.9; font-size: 0.9rem; margin-top: 0.25rem;">${slide.subtitle}</div>`;
                }
                
                if (slide.header) {
                    html += `<div style="color: ${isTitle ? 'rgba(255,255,255,0.9)' : theme.colorSecondary}; font-size: 0.85rem; margin-top: 0.25rem; font-style: italic;">${slide.header}</div>`;
                }
                
                if (slide.imageDescription) {
                    html += `<div style="background: #f0f4ff; border: 2px dashed ${theme.colorAccent}; padding: 0.5rem; margin-top: 0.5rem; border-radius: 4px; font-size: 0.75rem; color: #666; text-align: center;">üì∏ ${slide.imageDescription}</div>`;
                }
                
                if (slide.content && slide.content.length > 0) {
                    if (slide.layout === 'three-column') {
                        const third = Math.ceil(slide.content.length / 3);
                        const col1 = slide.content.slice(0, third);
                        const col2 = slide.content.slice(third, third * 2);
                        const col3 = slide.content.slice(third * 2);
                        
                        html += `
                            <div class="slide-content" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.75rem; margin-top: 0.5rem;">
                                <ul style="margin: 0; padding-left: 1rem; font-size: 0.75rem; line-height: 1.3;">
                                    ${col1.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                                <ul style="margin: 0; padding-left: 1rem; font-size: 0.75rem; line-height: 1.3;">
                                    ${col2.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                                <ul style="margin: 0; padding-left: 1rem; font-size: 0.75rem; line-height: 1.3;">
                                    ${col3.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                    } else if (slide.layout === 'two-column') {
                        const half = Math.ceil(slide.content.length / 2);
                        const col1 = slide.content.slice(0, half);
                        const col2 = slide.content.slice(half);
                        
                        html += `
                            <div class="slide-content" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 0.5rem;">
                                <ul style="margin: 0; padding-left: 1.25rem; font-size: 0.85rem; line-height: 1.4;">
                                    ${col1.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                                <ul style="margin: 0; padding-left: 1.25rem; font-size: 0.85rem; line-height: 1.4;">
                                    ${col2.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                    } else if (slide.layout === 'framework') {
                        html += `
                            <div class="slide-content" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-top: 0.5rem;">
                                ${slide.content.map(item => `
                                    <div style="background: #f8f9fa; border-left: 3px solid ${theme.colorAccent}; padding: 0.5rem; border-radius: 4px; font-size: 0.8rem; line-height: 1.4;">
                                        ${item}
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    } else if (slide.layout === 'process-flow') {
                        html += `
                            <div class="slide-content" style="margin-top: 0.5rem;">
                                ${slide.content.map((item, idx) => `
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                        <span style="background: ${theme.colorAccent}; color: white; font-weight: bold; min-width: 1.5rem; height: 1.5rem; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">
                                            ${idx + 1}
                                        </span>
                                        <span style="flex: 1; background: linear-gradient(90deg, ${theme.colorPrimary}15 0%, ${theme.colorPrimary}05 100%); padding: 0.35rem 0.75rem; border-left: 2px solid ${theme.colorAccent}; font-size: 0.8rem; line-height: 1.3;">
                                            ${item}
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="slide-content">
                                <ul style="margin: 0.5rem 0 0 0; padding-left: 1.25rem; font-size: 0.85rem; line-height: 1.4;">
                                    ${slide.content.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                    }
                }
                
                html += `</div>`;
            });
            
            preview.innerHTML = html;
        }

        async function generatePresentation() {
            const text = document.getElementById('textInput').value.trim();
            const apiKey = getApiKey();
            
            if (!apiKey) {
                showStatus('‚ö†Ô∏è Please enter your API key first!', 'error');
                return;
            }
            
            if (!text) {
                showStatus('‚ö†Ô∏è Please enter some text!', 'error');
                return;
            }
            
            // If no preview generated yet, generate one first
            if (!currentSlideData) {
                await generatePreview();
                if (!currentSlideData) return; // Preview failed
            }
            
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Creating PowerPoint...';
            showStatus('üìä Generating your professional PowerPoint...', 'info');
            
            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ text, apiKey, provider: currentProvider, slideData: currentSlideData })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Generation failed');
                }
                
                // Download the file
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'AI-Presentation-Pro.pptx';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                showStatus('‚úÖ Professional presentation downloaded successfully!', 'success');
            } catch (error) {
                console.error('Error:', error);
                if (error.message.includes('401') || error.message.includes('authentication')) {
                    showStatus('‚ùå Invalid API key. Please check and try again.', 'error');
                } else {
                    showStatus('‚ùå Error: ' + error.message, 'error');
                }
            } finally {
                btn.disabled = false;
                btn.innerHTML = '‚ú® Generate PowerPoint';
            }
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        // Example templates by category
        const exampleTemplates = {
            tech: `The Future of Artificial Intelligence in Healthcare

Artificial intelligence is revolutionizing healthcare by improving diagnostics, personalizing treatment plans, and accelerating drug discovery. Machine learning algorithms can now detect diseases from medical images with accuracy rivaling human experts.

Key applications include early cancer detection through image analysis, predictive analytics for patient outcomes, robotic surgery assistance, and virtual health assistants. AI-powered tools are reducing diagnostic errors and helping doctors make better informed decisions.

The integration of AI with electronic health records enables personalized medicine by analyzing patient data to recommend optimal treatments. Natural language processing helps extract insights from medical literature and patient notes.

Challenges remain including data privacy concerns, the need for regulatory frameworks, potential algorithmic bias, and ensuring AI systems are explainable to healthcare providers. Despite these hurdles, AI promises to make healthcare more accessible and effective for everyone.`,
            
            business: `Digital Transformation Strategy for Modern Enterprises

Digital transformation is no longer optional for businesses seeking to remain competitive in today's fast-paced market. Companies must embrace cloud computing, data analytics, and automation to streamline operations and improve customer experiences.

Key pillars of successful transformation include cloud migration for scalability, data-driven decision making through advanced analytics, customer experience optimization using digital channels, and process automation to reduce costs and errors.

The journey requires strong leadership commitment, clear vision and roadmap, investment in technology infrastructure, and a culture of continuous innovation. Companies must also focus on upskilling employees to work effectively with new technologies.

Success metrics include improved operational efficiency, enhanced customer satisfaction, faster time to market for new products, and increased revenue through digital channels. Regular assessment and adjustment of strategies ensures continued relevance and competitive advantage.`,
            
            education: `Innovative Teaching Methods for the 21st Century Classroom

Modern education must evolve to prepare students for a rapidly changing world. Traditional lecture-based approaches are giving way to interactive, technology-enhanced learning experiences that foster critical thinking and collaboration.

Effective teaching strategies include project-based learning where students solve real-world problems, flipped classroom models that maximize in-class interaction time, gamification to increase engagement and motivation, and personalized learning paths adapted to individual student needs.

Technology integration enhances learning through virtual reality field trips, collaborative online platforms for group projects, adaptive learning software that adjusts to student progress, and digital portfolios showcasing student achievements.

Assessment methods are also evolving beyond traditional tests to include peer evaluation, self-reflection exercises, practical demonstrations of skills, and ongoing formative feedback that guides learning. These approaches better prepare students for future careers and lifelong learning.`,
            
            health: `Mental Health Awareness in the Modern Workplace

Mental health has become a critical concern for organizations worldwide. Creating supportive work environments that prioritize employee wellbeing leads to improved productivity, reduced turnover, and stronger company culture.

Common workplace stressors include high workload and tight deadlines, lack of work-life balance, insufficient recognition and support, unclear expectations and poor communication, and limited opportunities for growth and development.

Effective organizational strategies include flexible work arrangements, mental health resources and counseling services, stress management workshops, open communication channels for concerns, and leadership training on mental health awareness.

Individual practices that support mental health include regular exercise and physical activity, mindfulness and meditation practices, maintaining social connections, setting healthy boundaries, and seeking professional help when needed. Creating a culture where mental health is openly discussed reduces stigma and encourages people to seek support.`,
            
            marketing: `Content Marketing Strategies for 2024

Content marketing continues to evolve as consumer behaviors shift and new platforms emerge. Successful brands focus on creating authentic, valuable content that resonates with their target audience across multiple channels.

Key trends shaping content strategy include short-form video dominance on platforms like TikTok and Instagram Reels, interactive content that engages audiences through quizzes and polls, user-generated content that builds community and trust, and AI-powered personalization for tailored experiences.

Essential components of effective campaigns include consistent brand voice across all channels, data-driven optimization based on performance metrics, multi-platform distribution for maximum reach, and authentic storytelling that connects emotionally with audiences.

Measuring success requires tracking engagement rates and time spent with content, conversion metrics and ROI analysis, audience growth and retention, brand sentiment and awareness, and content performance across different channels. Regular analysis enables continuous improvement and strategic adjustments.`,
            
            environment: `Sustainable Business Practices for a Greener Future

Environmental sustainability has become a business imperative as consumers, investors, and regulators demand responsible corporate behavior. Companies that embrace sustainable practices gain competitive advantages while contributing to global environmental goals.

Key areas for action include reducing carbon footprint through energy efficiency and renewable energy adoption, implementing circular economy principles to minimize waste, sustainable supply chain management with ethical sourcing, and water conservation in operations and products.

Business benefits of sustainability include cost savings through resource efficiency, enhanced brand reputation and customer loyalty, access to green financing and investment, improved risk management and regulatory compliance, and attraction of top talent who value corporate responsibility.

Implementation strategies involve setting measurable sustainability goals with clear timelines, conducting environmental impact assessments, engaging stakeholders in sustainability initiatives, transparent reporting of progress and challenges, and continuous innovation in sustainable products and processes. Leadership commitment and employee engagement are essential for success.`
        };

        function loadExampleByCategory(category) {
            const text = exampleTemplates[category];
            if (text) {
                document.getElementById('textInput').value = text;
                showStatus(`üìù ${category.charAt(0).toUpperCase() + category.slice(1)} example loaded. Click "Preview Slides" to see the design.`, 'info');
            }
        }

        // Generate content from AI prompt with slide count and image generation
        async function generateFromPrompt() {
            const prompt = document.getElementById('textInput').value.trim();
            const numSlides = parseInt(document.getElementById('numSlides').value) || 6;
            const generateImages = document.getElementById('generateImages').checked;
            const apiKey = getApiKey();
            const fileInput = document.getElementById('fileUpload');
            const files = fileInput.files;
            
            if (!apiKey) {
                showStatus('‚ö†Ô∏è Please enter your API key first!', 'error');
                return;
            }
            
            if (!prompt && files.length === 0) {
                showStatus('‚ö†Ô∏è Please enter text or attach files!', 'error');
                return;
            }
            
            const promptBtn = document.getElementById('promptBtn');
            promptBtn.disabled = true;
            promptBtn.innerHTML = '<span class="spinner"></span> Generating content...';
            
            showStatus('ü§ñ AI is creating content...', 'info');
            
            try {
                let content = '';
                
                // If files are attached, process them with the prompt
                if (files.length > 0) {
                    const fileContents = [];
                    
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        const text = await readFileAsText(file);
                        fileContents.push({
                            filename: file.name,
                            content: text
                        });
                    }
                    
                    // Combine file contents
                    let combinedFiles = '';
                    fileContents.forEach(file => {
                        combinedFiles += `\n\n=== File: ${file.filename} ===\n\n${file.content}`;
                    });
                    
                    // If there's a prompt, use it to guide the processing; otherwise use default
                    const finalPrompt = prompt 
                        ? `${prompt}\n\nUse the following file content as the base:\n${combinedFiles}`
                        : `Analyze and convert the following files into a well-structured presentation with ${numSlides} slides:\n${combinedFiles}`;
                    
                const response = await fetch('/api/generate-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                            prompt: finalPrompt, 
                        apiKey, 
                        provider: currentProvider,
                        numSlides,
                        generateImages
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Content generation failed');
                }
                
                const result = await response.json();
                    content = result.content;
                
                } else {
                    // No files, just use the prompt
                    const response = await fetch('/api/generate-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                            prompt, 
                        apiKey, 
                            provider: currentProvider,
                            numSlides,
                            generateImages
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                        throw new Error(error.error || 'Content generation failed');
                }
                
                const result = await response.json();
                    content = result.content;
                }
                
                document.getElementById('textInput').value = content;
                showStatus('‚úÖ Content generated! Review and click "Preview Slides" to see the design.', 'success');
                
            } catch (error) {
                console.error('Error:', error);
                if (error.message.includes('401') || error.message.includes('authentication')) {
                    showStatus('‚ùå Invalid API key. Please check and try again.', 'error');
                } else {
                showStatus('‚ùå Error: ' + error.message, 'error');
                }
            } finally {
                promptBtn.disabled = false;
                promptBtn.innerHTML = '‚ú® Generate Content from Text/Files';
            }
        }
        
        // Helper function to read file as text
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(new Error('Failed to read file'));
                reader.readAsText(file);
            });
        }
    </script>
</body>
</html>